!function(S,q){"use strict";var i="ht",R=S[i],V=R.Default,L=V.def,I="add",e="remove",Q=V.getInternal(),r="propertyChange";R.HistoryManager=function(g){this._histories=[],this.setDataModel(g)},L(R.HistoryManager,q,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var C=this;C.$4p++,1===C.$4p&&(C.$3p=[])},endInteraction:function(){var B=this,L=B._histories,Y=B._historyIndex,p=B.$3p;B.$4p--,0===B.$4p&&(delete B.$3p,p.length&&(L=L.slice(0,Y+1),L.push(p),L.length>B._maxHistoryCount&&(L=L.slice(L.length-B._maxHistoryCount)),B.setHistories(L),B.setHistoryIndex(L.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(X){var E=this,p=E._dataModel;p!==X&&(p&&(delete p._historyManager,p.umm(E.$5p,E),p.umd(E.$6p,E)),E._dataModel=X,X._historyManager=E,X.mm(E.$5p,E),X.md(E.$6p,E),E.fp("dataModel",p,X),E.clear())},setHistoryIndex:function(d,K){var X=this,k=X._historyIndex,R=X._histories.length;if(-1>d?d=-1:d>=R&&(d=R-1),k!==d){if(!K){var s=d-k;s>0?X.$2p(s):0>s&&X.$1p(-s)}X._historyIndex=d,X.fp("historyIndex",k,d)}},setMaxHistoryCount:function(J){var A=this,i=A._histories,S=A._maxHistoryCount;(!J||0>=J)&&(J=10),S!==J&&(A._maxHistoryCount=J,A.fp("maxHistoryCount",S,J),i.length>J&&A.clear())},$5p:function(s){if(!this.$7p&&!this.$8p){var P,o,v=this,G=v._histories,a=s.kind,X=s.property,p=v._historyIndex;if(a===I||a===e?o={type:s.kind,data:s.data}:X&&"children"!==X&&"attaches"!==X&&"shape"!==X&&(o={type:r,data:s.data,property:X,oldValue:s.oldValue,newValue:s.newValue}),o)if(v.$4p){P=v.$3p;var y=!1;if(o.type===r)for(var q=P.length-1;q>=0;q--){var K=P[q];if(K.type!==r)break;o.property===K.property&&K.property&&o.data===K.data&&(o.oldValue=K.oldValue,P[q]=o,y=!0)}y||P.push(o)}else P=[o],G=G.slice(0,p+1),G.push(P),G.length>v._maxHistoryCount&&(G=G.slice(G.length-v._maxHistoryCount)),v.setHistories(G),v.setHistoryIndex(G.length-1,!0)}},$6p:function(S){this.$5p(S)},undo:function(P){(!P||0>=P)&&(P=1),this.setHistoryIndex(this._historyIndex-P)},$1p:function(k){var s,j=this,x=j._dataModel,r=j._histories,f=j._historyIndex;for(j.$7p=1,V.setIsolating(!0);k>0;){if(f>=0&&f<r.length){s=r[f],f--;for(var c=s.length-1;c>=0;c--){var F=s[c],J=F.type,P=F.data,D=F.property,v=F.oldValue;if(J===I)x.remove(P);else if(J===e)x.add(P);else{var T=null;0===D.indexOf("a:")?(T="attr",D=D.replace("a:","")):0===D.indexOf("s:")&&(T="style",D=D.replace("s:","")),Q.setPropertyValue(P,T,D,v)}}}k--}V.setIsolating(!1),delete j.$7p},redo:function(U){(!U||0>=U)&&(U=1),this.setHistoryIndex(this._historyIndex+U)},$2p:function(A){var w,X=this,v=X._dataModel,o=X._histories,z=X._historyIndex;for(X.$7p=1,V.setIsolating(!0);A>0;){if(z>=-1&&z<o.length-1){z++,w=o[z];for(var u=0;u<w.length;u++){var h=w[u],r=h.type,R=h.data,S=h.property,g=h.newValue;if(r===I)v.add(R);else if(r===e)v.remove(R);else{var $=null;0===S.indexOf("a:")?($="attr",S=S.replace("a:","")):0===S.indexOf("s:")&&($="style",S=S.replace("s:","")),Q.setPropertyValue(R,$,S,g)}}}A--}V.setIsolating(!1),delete X.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);