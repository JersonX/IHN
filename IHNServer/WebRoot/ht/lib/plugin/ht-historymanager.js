!function(A,X){"use strict";var z="ht",v=A[z],D=v.Default,$=D.def,w="add",Y="remove",Q=D.getInternal(),h="propertyChange";v.HistoryManager=function(L){this._histories=[],this.setDataModel(L)},$(v.HistoryManager,X,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var P=this;P.$4p++,1===P.$4p&&(P.$3p=[])},endInteraction:function(){var L=this,U=L._histories,l=L._historyIndex,F=L.$3p;L.$4p--,0===L.$4p&&(delete L.$3p,F.length&&(U=U.slice(0,l+1),U.push(F),U.length>L._maxHistoryCount&&(U=U.slice(U.length-L._maxHistoryCount)),L.setHistories(U),L.setHistoryIndex(U.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(r){var t=this,f=t._dataModel;f!==r&&(f&&(delete f._historyManager,f.umm(t.$5p,t),f.umd(t.$6p,t)),t._dataModel=r,r._historyManager=t,r.mm(t.$5p,t),r.md(t.$6p,t),t.fp("dataModel",f,r),t.clear())},setHistoryIndex:function(u,c){var U=this,d=U._historyIndex,x=U._histories.length;if(-1>u?u=-1:u>=x&&(u=x-1),d!==u){if(!c){var i=u-d;i>0?U.$2p(i):0>i&&U.$1p(-i)}U._historyIndex=u,U.fp("historyIndex",d,u)}},setMaxHistoryCount:function(i){var J=this,d=J._histories,Q=J._maxHistoryCount;(!i||0>=i)&&(i=10),Q!==i&&(J._maxHistoryCount=i,J.fp("maxHistoryCount",Q,i),d.length>i&&J.clear())},$5p:function(V){if(!this.$7p&&!this.$8p){var A,y,M=this,Q=M._histories,B=V.kind,p=V.property,g=M._historyIndex;if(B===w||B===Y?y={type:V.kind,data:V.data}:p&&"children"!==p&&"attaches"!==p&&"shape"!==p&&(y={type:h,data:V.data,property:p,oldValue:V.oldValue,newValue:V.newValue}),y)if(M.$4p){A=M.$3p;var z=!1;if(y.type===h)for(var L=A.length-1;L>=0;L--){var n=A[L];if(n.type!==h)break;y.property===n.property&&n.property&&y.data===n.data&&(y.oldValue=n.oldValue,A[L]=y,z=!0)}z||A.push(y)}else A=[y],Q=Q.slice(0,g+1),Q.push(A),Q.length>M._maxHistoryCount&&(Q=Q.slice(Q.length-M._maxHistoryCount)),M.setHistories(Q),M.setHistoryIndex(Q.length-1,!0)}},$6p:function(s){this.$5p(s)},undo:function(V){(!V||0>=V)&&(V=1),this.setHistoryIndex(this._historyIndex-V)},$1p:function(b){var B,T=this,A=T._dataModel,m=T._histories,G=T._historyIndex;for(T.$7p=1,D.setIsolating(!0);b>0;){if(G>=0&&G<m.length){B=m[G],G--;for(var Z=B.length-1;Z>=0;Z--){var F=B[Z],O=F.type,l=F.data,L=F.property,R=F.oldValue;if(O===w)A.remove(l);else if(O===Y)A.add(l);else{var h=null;0===L.indexOf("a:")?(h="attr",L=L.replace("a:","")):0===L.indexOf("s:")&&(h="style",L=L.replace("s:","")),Q.setPropertyValue(l,h,L,R)}}}b--}D.setIsolating(!1),delete T.$7p},redo:function(C){(!C||0>=C)&&(C=1),this.setHistoryIndex(this._historyIndex+C)},$2p:function(P){var i,x=this,L=x._dataModel,p=x._histories,S=x._historyIndex;for(x.$7p=1,D.setIsolating(!0);P>0;){if(S>=-1&&S<p.length-1){S++,i=p[S];for(var j=0;j<i.length;j++){var a=i[j],$=a.type,H=a.data,A=a.property,s=a.newValue;if($===w)L.add(H);else if($===Y)L.remove(H);else{var Z=null;0===A.indexOf("a:")?(Z="attr",A=A.replace("a:","")):0===A.indexOf("s:")&&(Z="style",A=A.replace("s:","")),Q.setPropertyValue(H,Z,A,s)}}}P--}D.setIsolating(!1),delete x.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);