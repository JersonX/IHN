!function(K,X){"use strict";var L=ht.AlarmSeverity=function(_,G,p,a,g){this.value=_,this.name=G,this.nickName=p,this.color=a,this.displayName=g};ht.Default.def("ht.AlarmSeverity",X,{toString:function(){return this.displayName||this.name}}),function(){L.severities=new ht.List,L._vm={},L._nm={},L._cp=function(p,Z){if(p&&Z){var B=p.value-Z.value;return B>0?1:0>B?-1:0}return p&&!Z?1:!p&&Z?-1:0},L.each=function(J,F){L.severities.each(J,F)},L.getSortFunction=function(){return L._cp},L.setSortFunction=function(c){L._cp=c,L.severities.sort(c)},L.add=function($,v,Q,x,H){var U=new L($,v,Q,x,H);return L._vm[$]=U,L._nm[v]=U,L.severities.add(U),L.severities.sort(L._cp),U},L.remove=function(Z){var s=L._nm[Z];return s&&(delete L._nm[Z],delete L._vm[s.value],L.severities.remove(s)),s},L.CRITICAL=L.add(500,"Critical","C","#FF0000"),L.MAJOR=L.add(400,"Major","M","#FFA000"),L.MINOR=L.add(300,"Minor","m","#FFFF00"),L.WARNING=L.add(200,"Warning","W","#00FFFF"),L.INDETERMINATE=L.add(100,"Indeterminate","N","#C800FF"),L.CLEARED=L.add(0,"Cleared","R","#00FF00"),L.isClearedAlarmSeverity=function(Y){return Y?0===Y.value:!1},L.getByName=function(n){return L._nm[n]},L.getByValue=function(K){return L._vm[K]},L.clear=function(){L.severities.clear(),L._vm={},L._nm={}},L.compare=function(H,d){return L._cp(H,d)}}();var y=ht.AlarmState=function(A){this._d=A,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",X,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var c=null;for(var p in this._am)p=L.getByName(p),L.isClearedAlarmSeverity(p)||0!==this.getAcknowledgedAlarmCount(p)&&(c=c?L.compare(c,p)>0?c:p:p);this._haa=c},_c2:function(){var e=null;for(var o in this._nm)o=L.getByName(o),L.isClearedAlarmSeverity(o)||0!==this.getNewAlarmCount(o)&&(e=e?L.compare(e,o)>0?e:o:o);this._hna=e},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var W in this._nm)if(W=L.getByName(W),!L.isClearedAlarmSeverity(W)&&0!==this.getNewAlarmCount(W)&&L.compare(this._hna,W)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var w=this._haa,c=this._hna,B=this._ps;this._hoa=w,L.compare(c,this._hoa)>0&&(this._hoa=c),L.compare(B,this._hoa)>0&&(this._hoa=B)},_c5:function(){var b=this._haa,E=this._hna;this._hta=b,L.compare(E,this._hta)>0&&(this._hta=E)},increaseAcknowledgedAlarm:function(X,F){if(0!==F){F=F||1;var u=this._am[X.name]||0;u+=F,this._am[X.name]=u,this._f()}},increaseNewAlarm:function(i,V){if(0!==V){V=V||1;var h=this._nm[i.name]||0;h+=V,this._nm[i.name]=h,this._f()}},decreaseAcknowledgedAlarm:function(i,u){if(0!==u){u||(u=1);var D=this._am[i.name]||0;if(D-=u,0>D)throw"Alarm count can not be negative";this._am[i.name]=D,this._f()}},decreaseNewAlarm:function(A,G){if(0!==G){G||(G=1);var h=this._nm[A.name]||0;if(h-=G,0>h)throw"Alarm count can not be negative";this._nm[A.name]=h,this._f()}},acknowledgeAlarm:function(K){this.decreaseNewAlarm(K,1),this.increaseAcknowledgedAlarm(K,1)},acknowledgeAllAlarms:function(x){if(x){var U=this.getNewAlarmCount(x);this.decreaseNewAlarm(x,U),this.increaseAcknowledgedAlarm(x,U)}else for(var r in this._nm)this.acknowledgeAllAlarms(L.getByName(r))},_c6:function(){this._aac=0;for(var K in this._am)K=L.getByName(K),this._aac+=this.getAcknowledgedAlarmCount(K)},getAcknowledgedAlarmCount:function(e){return e?this._am[e.name]||0:this._aac},getAlarmCount:function(k){return this.getAcknowledgedAlarmCount(k)+this.getNewAlarmCount(k)},_c7:function(){this._nac=0;for(var k in this._nm)this._nac+=this.getNewAlarmCount(L.getByName(k))},getNewAlarmCount:function(y){return y?this._nm[y.name]||0:this._nac},setNewAlarmCount:function(V,_){this._nm[V.name]=_,this._f()},removeAllNewAlarms:function(g){g?delete this._nm[g]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(R,k){this._am[R.name]=k,this._f()},removeAllAcknowledgedAlarms:function(Q){Q?delete this._am[Q.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(v){if(this._ep||(v=null),this._ps!==v){var h=this._ps;this._ps=v,this._f(),this._d.fp("propagateSeverity",h,v)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(E){var u=this._ep;this._ep=E,this._d.fp("enablePropagation",u,E)&&(E||this.setPropagateSeverity(null))}});var W=ht.AlarmStatePropagator=function(f){this._dataModel=f,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",X,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(F){this._enable!==F&&(this._enable=F,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(C){this.propagate(C)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(T){T.data&&this.propagate(T.data)},handleDataPropertyChange:function(Z){if("alarmState"===Z.property||"enablePropagation"===Z.property)this.propagate(Z.data);else if("parent"===Z.property){var F=Z.oldValue;F&&this.propagate(F),this.propagate(Z.data)}},propagate:function(x){x&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(x),this._isPropagating=!1)},propagateToTop:function(e){for(this.propagateToParent(null,e);e&&e.getParent();)this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(U,f){var C=null;f.getChildren().each(function(N){var y=N.getAlarmState().getHighestOverallAlarmSeverity();L.compare(y,C)>0&&(C=y)}),f.getAlarmState().setPropagateSeverity(C)}}),ht.AlarmStateStatistics=function(p){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(p)},ht.Default.def("ht.AlarmStateStatistics",X,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(f){var X=this._dataModel;X!==f&&(X&&(X.umd(this.handleDataPropertyChange,this),X.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=f,this.reset(),f.md(this.handleDataPropertyChange,this),f.mm(this.handleDataModelChange,this),this.fp("dataModel",X,f))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(L){"alarmState"===L.property&&(this.increase(L.data),this.fireAlarmStateChange())},handleDataModelChange:function(v){"add"===v.kind?(this.increase(v.data),this.fireAlarmStateChange()):"remove"===v.kind?(this.decrease(v.data),this.fireAlarmStateChange()):"clear"===v.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,L.each(function(E){var A=this.getSumInfo(E);this.sumAcked+=A.ackedCount,this.sumNew+=A.newCount,this.sumTotal+=A.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(i){if(!i)return this.sumNew;var h=this.getSumInfo(i);return h.newCount},getAcknowledgedAlarmCount:function(O){if(!O)return this.sumAcked;var z=this.getSumInfo(O);return z.ackedCount},getTotalAlarmCount:function(V){if(!V)return this.sumTotal;var Z=this.getSumInfo(V);return Z.totalCount},getSumInfo:function(H){var O=this.severtiyMap[H.name];return O||(O={},O.newCount=0,O.ackedCount=0,O.totalCount=0,this.severtiyMap[H.name]=O),O},decrease:function(J){var Z=this.dataMap[J.getId()];Z&&(delete this.dataMap[J.getId()],L.each(function(c){var R=Z[c.name],k=this.getSumInfo(c);k.newCount=k.newCount-R.newCount,k.ackedCount=k.ackedCount-R.ackedCount,k.totalCount=k.totalCount-R.totalCount},this))},increase:function(s){if(this.decrease(s),!this._filterFunc||this._filterFunc(s)){var f={},d=s.getAlarmState();this.dataMap[s.getId()]=f,L.each(function(I){var g={};g.newCount=d.getNewAlarmCount(I),g.ackedCount=d.getAcknowledgedAlarmCount(I),g.totalCount=d.getAlarmCount(I),f[I.name]=g;var Z=this.getSumInfo(I);Z.newCount=Z.newCount+g.newCount,Z.ackedCount=Z.ackedCount+g.ackedCount,Z.totalCount=Z.totalCount+g.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(m){var H=this._filterFunc;this._filterFunc=m,this.reset(),this.firePropertyChange("filterFunc",H,m)},getFilterFunc:function(){return this._filterFunc}});var O=ht.Data.prototype;O.getAlarmState=function(){return this._alarmState||(this._alarmState=new y(this))},O=ht.DataModel.prototype,O.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},O.setEnableAlarmStatePropagator=function(S){S!=this.isEnableAlarmStatePropagator()&&(S?(this._alarmStatePropagator=new W(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},O=ht.graph.GraphView.prototype,O.getNote2=function(I){var T=I.getAlarmState().getHighestNewAlarmSeverity();if(T){var C=I.getAlarmState().getNewAlarmCount(T)+T.nickName;return I.getAlarmState().hasLessSevereNewAlarms()&&(C+="+"),C}return I.s("note2")},O.getNote2Background=function(Z){var M=Z.getAlarmState().getHighestNewAlarmSeverity();return M?M.color:Z.s("note2.background")},O.getBodyColor=function(C){var D=C.getAlarmState().getHighestNativeAlarmSeverity();return D?D.color:C.s("body.color")},O.getBorderColor=function(j){var V=j.getAlarmState().getPropagateSeverity();return V?V.color:j.s("border.color")},O=ht.widget.TreeView.prototype,O.getBorderColor=function(R){var Z=R.getAlarmState().getPropagateSeverity();return Z?Z.color:R.s("border.color")},O.getIcon=function(r){return r.getIcon()?"__alarmIcon__":null},O=ht.widget.TreeTableView.prototype,O.getBorderColor=function(l){var G=l.getAlarmState().getPropagateSeverity();return G?G.color:l.s("border.color")},O.getIcon=function(v){return v.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(u){return u.getIcon()}},color:{func:function(d){var h=d.getAlarmState().getHighestNativeAlarmSeverity();return h?h.color:d.s("body.color")}},rect:[0,0,16,16]}]});var Y=ht.Style;Y["note2.expanded"]=!0,Y["note2.color"]="#000"}(this,Object);