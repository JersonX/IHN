!function(M){"use strict";var g="ht",r=M[g],i=r.Default,u=Math,Q=u.PI,X=2*Q,T=u.sin,D=u.cos,e=u.atan2,z=u.sqrt,H=u.max,J=u.floor,C=(u.round,u.ceil),k=u.abs,N=r.Shape,s=r.Edge,K=r.List,b=r.Style,U=r.graph,m=i.getInternal(),R=m.ui(),t=null,x="__segmentLengths",p="__lineTotalLength",F="__linePoints",P="__distance0",j="flow.count",G="flow.step",w="flow.element.max",v="flow.element.count",E="flow.element.min",o="flow.element.space",y="flow.element.autorotate",L="flow.element.background",S="flow.element.shadow.max",a="flow.element.shadow.min",Y="flow.element.shadow.begincolor",n="flow.element.shadow.endcolor",d="flow.element.shadow.visible",$="flow.element.image",q="flow",B="prototype",V=function(q){return document.createElement(q)},l=function(K){for(var n=0,a=K.length-1,U=0;a>U;U++){var k=K[U],W=K[U+1],v=W.x-k.x,q=W.y-k.y,p=z(v*v+q*q);n+=p}return n},I=function(l,E){for(var c=0,B=0,A=0,K=l.length-1,m=0;K>m;m++){var q=l[m],b=l[m+1],C=b.x-q.x,x=b.y-q.y;if(A=z(C*C+x*x),c+=A,c>E){c-=A,B=m;break}}var Z=l[B],h=l[B+1],U=e(h.y-Z.y,h.x-Z.x),j=E-c,x=T(U)*j,C=D(U)*j;return{x:Z.x+C,y:Z.y+x}},c=function(V,x,B,e){var I=D(e),o=T(e),S=I*x-o*B,H=o*x+I*B;return V?{x:V.x+S,y:V.y+H}:{x:S,y:H}},A=function(Q,g){Q[x]=Q[p]=Q[F]=g[P]=t},f=function(I,H,c,Z,p,G){var y,_,J,x,A,n,o,b,v,l,O,E=[];if(k(Z)>X&&(Z=X),A=C(k(Z)/(Q/4)),y=Z/A,_=-y,J=-c,A>0){n=I+D(c)*p,o=H+T(-c)*G,E.push({x:n,y:o});for(var q=0;A>q;q++)J+=_,x=J-_/2,b=I+D(J)*p,v=H+T(J)*G,l=I+D(x)*(p/D(_/2)),O=H+T(x)*(G/D(_/2)),E.push({x:l,y:O}),E.push({x:b,y:v})}return E},W=function(A){var w,L,V=A._data;if(V instanceof N){if(w=V.getPoints(),L=V.getSegments(),(!L||0===L.size())&&w){L=new r.List([1]);for(var e=1;e<w.size();e++)L.add(2)}}else if(V instanceof s){var U=A._78o;if(U){var g=U.type,v=U.points,q=U.segments,b=U._4O;if(!g||v){var E=U._69o,n=E.x,z=E.y,Q=U._70o,I=Q.x,P=Q.y;if(g)q?(w=new K({x:n,y:z}),w.addAll(v),w.add({x:I,y:P}),L=new K(q._as)):(w=new K({x:n,y:z}),L=new K([1]),v.each(function(Y){w.add(Y),L.add(2)}),w.add({x:I,y:P}),L.add(2));else if(U.looped){w=new K(f(n,z,0,X,U.radius,U.radius)),L=new K([1]);for(var e=0;e<(w.size()-1)/2;e++)L.add(3)}else w=new K,U.center?(w.add({x:U.c1.x,y:U.c1.y}),w.add({x:n,y:z}),w.add({x:I,y:P}),w.add({x:U.c2.x,y:U.c2.y}),L=new K([1,2,2,2])):(w.add({x:n,y:z}),w.add({x:I,y:P}),L=new K([1,2]))}else if(b)if(w=new K(b.points._as),b.segments)L=new K(b.segments._as);else{L=new K([1]);for(var e=1;e<b.points.size();e++)L.add(2)}}}if(w&&L){for(var $=m.toPointsArray(w._as,L._as,50),S=$.length,u=[],e=0;S>e;e++){var h=$[e];h.length>1&&u.push($[e])}V.s("flow.reverse")&&(u.reverse(),u.forEach(function(M){M.reverse()}));for(var c=0,R=[],D=u.length,e=0;D>e;e++){var h=u[e],y=l(h);c+=y,R.push(y)}if(V[x]=R,V[p]=c,V[F]=u,V instanceof s){var Y=i.unionPoint(u),j=Y.x+Y.width/2,W=Y.y+Y.height/2;V.$10e={x:j,y:W}}Z(A,!0)}},Z=function(Z,e){var m=Z._data,g=m[p],M=m.s(j),q=m.s(G),T=0,L=m[x],B=m.s(w),o=m.s(E),r=m.s(v),N=(B-o)/(r-1),a=[];if(L){if(1===r)a.push(B);else if(2===r)a.push(B),a.push(o);else{if(!(r>2))return;a.push(B);for(var F=r-2;F>0;F--)a.push(o+N*F);a.push(o)}var X=0,t=0;a.forEach(function(S){r-1>X&&(t+=m.getFlowElementSpace(S)),X++}),t+=(B+o)/2,T=(g-M*t+t)/M;var C=Z[P];for(null==C&&(C=0),e||(C+=q);C>g+t;){var l=Z._overCount;l?l++:l=1,l>=M&&(l=null),Z._overCount=l,m.s("flow.autoreverse")?l?C-=T+t:(C=0,m.s("flow.reverse",!m.s("flow.reverse"))):C-=T+t}Z[P]=C}},_=function(d){var K=d.data,N=this.dm();if(K&&"add"===d.kind){var Q=N.$3e;Q&&K.s(q)&&Q.indexOf(K)<0&&Q.push(K)}"clear"===d.kind&&(N.$3e=[])},h=function(W){var $=W.property,j=W.data,R=W.newValue,l=this.dm().$3e;if(l&&"s:flow"===$)if(R)l.indexOf(j)<0&&l.push(j);else for(var V=l.length,v=0;V>v;v++)if(l[v]===j){l.splice(v,1);break}},O=function(x,e){for(var V=0,k=e.length,m=0;k>m;m++){var l=e[m];if(V+=l,V>x)return m}return m},Sj=function(l){var n=this,Y=n._data,M=Y[p],A=Y[x],T=Y[F],k=Y.s(j),q=0,X=n[P],g=Y.s(w),K=Y.s(E),o=Y.s(v),R=Y.s(a),u=Y.s(S),r=Y.s(y),N=(u-R)/(o-1),i=(g-K)/(o-1),B=Y.getRotation?Y.getRotation():0,Q=Y.getPosition?Y.p():Y.$10e,H=[],D=[];if(X!=t){if(1===o)H.push(g);else if(2===o)H.push(g),H.push(K);else{if(!(o>2))return;H.push(g);for(var b=o-2;b>0;b--)H.push(K+i*b);H.push(K)}if(1===o)D.push(u);else if(2===o)D.push(u),D.push(R);else{if(!(o>2))return;D.push(u);for(var b=o-2;b>0;b--)D.push(R+N*b);D.push(R)}var h=0,f=0;H.forEach(function(H){o-1>h&&(f+=Y.getFlowElementSpace(H)),h++}),f+=(g+K)/2,q=(M-k*f+f)/k,l.save();for(var b=0;k>b;b++){var W=X,$=0,J=n._overCount,L=0;Y.s("flow.autoreverse")&&J&&J>k-(b+1)||(W-=b*(q+f),h=0,H.forEach(function(o){var N=W-$;if(N>=0&&M>N){var q=!0,d=O(N,A);L=0;for(var b=0;d>b;b++)L+=A[b];if(N-=L,q){var E=I(T[d],N),P=B;if(r){for(var u=T[d],R=0,w=0,y=0;y<u.length-1;y++){var C=u[y],X=u[y+1],K=X.x-C.x,a=X.y-C.y,f=z(K*K+a*a);if(R+=f,R>N){w=y;break}}var i=u[w];P+=e(E.y-i.y,E.x-i.x)}B&&(E=c(Q,E.x-Q.x,E.y-Q.y,B)),n.$5e(l,E,o,D[h],P)}}$+=Y.getFlowElementSpace(H[h]),h++}))}l.restore()}},Nn=U.GraphView[B],dp=r.Data[B],pq=R.DataUI[B],Jq=R.ShapeUI[B],sf=R.EdgeUI[B],Ef=r.DataModel[B],Ri=Jq._80o,Dj=sf._80o,Cc=Ef.prepareRemove,ui=sf._79o,yj=Jq._79o,Po=Nn.setDataModel,cp=function(){var Q=this,a=Q._data,n=a.s(w),L=!1,f=t;if(Q._6I||(L=!0),f=a instanceof s?ui.call(Q):yj.call(Q),a.s(q)&&L){var j=a.s(S),p=a.s(d);p&&j>n&&(n=j),n>0&&i.grow(f,C(n/2)),W(Q)}return!a.s(q)&&L&&A(a,Q),f};dp.getFlowElementSpace=function(){return this.s(o)},Jq._79o=cp,sf._79o=cp,b[w]==t&&(b[w]=7),b[E]==t&&(b[E]=0),b[j]==t&&(b[j]=1),b[G]==t&&(b[G]=3),b[v]==t&&(b[v]=10),b[o]==t&&(b[o]=3.5),b[y]==t&&(b[y]=!1),b[L]==t&&(b[L]="rgba(255, 255, 114, 0.4)"),b[Y]==t&&(b[Y]="rgba(255, 255, 0, 0.3)"),b[n]==t&&(b[n]="rgba(255, 255, 0, 0)"),b[d]==t&&(b[d]=1),b[S]==t&&(b[S]=22),b[a]==t&&(b[a]=4),Ef.prepareRemove=function(d){Cc.call(this,d);var U=d._dataModel,s=U.$3e;if(s)for(var y=s.length,B=0;y>B;B++)if(s[B]===d){s.splice(B,1);break}},Nn.setDataModel=function(Q){var m=this,g=m._dataModel;if(g!==Q){g&&(g.umm(_,m),g.umd(h,m),g.$3e=[]),Q.mm(_,m),Q.md(h,m);var y=Q.$3e=[];Q.each(function(i){i.s(q)&&y.indexOf(i)<0&&y.push(i)}),Po.call(m,Q)}},Nn.setFlowInterval=function(p){var N=this,y=N.$11e;N.$11e=p,N.fp("flowInterval",y,p),N.$7e!=t&&(clearInterval(N.$7e),delete N.$7e,N.enableFlow(p))},Nn.getFlowInterval=function(){return this.$11e},Nn.$9e=function(){var N,G,E,U=this,f=U.tx(),W=U.ty(),g=U.getZoom(),u=U.getWidth(),Q=U.getHeight(),e={x:-f/g,y:-W/g,width:u/g,height:Q/g},r=U.dm().$3e,R=U._56I,A=new K;if(r.forEach(function(r){R[r.getId()]&&(N=U.getDataUI(r),N&&(E=N._79o(),E&&A.add(E)))}),0!==A.size()&&(A.each(function(O){i.intersectsRect(e,O)&&(G=i.unionRect(G,O))}),G&&(G&&(i.grow(G,H(1,1/g)),G.x=J(G.x*g)/g,G.y=J(G.y*g)/g,G.width=C(G.width*g)/g,G.height=C(G.height*g)/g,G=i.intersection(e,G)),G))){var v=U._canvas.getContext("2d");v.save(),v.lineCap=i.lineCap,v.lineJoin=i.lineJoin,m.translateAndScale(v,f,W,g),v.beginPath(),v.rect(G.x,G.y,G.width,G.height),v.clip(),v.clearRect(G.x,G.y,G.width,G.height),U.$6e(v,G),v.restore()}},Nn.$6e=function(M,H){var b,f,Z=this;Z._93db(M),Z.each(function(S){Z._56I[S._id]&&(b=Z.getDataUI(S),b&&(f=b._79o(),(!H||i.intersectsRect(H,f))&&b._42(M)))}),Z._92db(M)},Nn.enableFlow=function(e){var X=this,P=X.dm(),v=P.$3e;X.$7e==t&&(v.forEach(function(c){var y=X.getDataUI(c);W(y)}),X.$7e=setInterval(function(){P.$3e.forEach(function(L){Z(X.getDataUI(L))}),X.$9e()},e||X.$11e||50))},Nn.disableFlow=function(){var W=this;clearInterval(W.$7e),delete W.$7e;var c=W.dm().$3e;c&&W.$9e()},pq.$5e=function(T,u,f,N,Z){var y=this,h=y._data,O=y.gv,a=h.s(L),_=h.s(Y),P=h.s(n),G=h.s(d),A=O.$8e,C=h.s($);if(A==t&&(A=O.$8e={}),T.beginPath(),C!=t){var F=i.getImage(C),Q=f/2;T.translate(u.x,u.y),T.rotate(Z),T.translate(-u.x,-u.y),i.drawImage(T,F,u.x-Q,u.y-Q,f,f,h),T.translate(u.x,u.y),T.rotate(-Z),T.translate(-u.x,-u.y)}else T.fillStyle=a,T.arc(u.x,u.y,f/2,0,X,!0),T.fill();if(G){var x=22,J=x+"_"+_+"_"+P,E=A[J];if(E==t){var v=V("canvas");m.setCanvas(v,x,x);var U=v.getContext("2d"),R=x/2,g=R,K=R;m.translateAndScale(U,0,0,1),U.beginPath();var D=U.createRadialGradient(g,K,0,g,g,R);D.addColorStop(0,_),D.addColorStop(1,P),U.fillStyle=D,U.arc(g,K,R,0,X,!0),U.fill(),E=A[J]=v}var Q=N/2;i.drawImage(T,E,u.x-Q,u.y-Q,N,N,h)}},sf._80o=function(k){Dj.call(this,k);var o=this,c=o._data,f=o.gv;c.s(q)&&f.$7e!=t&&Sj.call(o,k)},Jq._80o=function(x){Ri.call(this,x);var Q=this,v=Q._data,K=Q.gv;v.s(q)&&K.$7e!=t&&Sj.call(Q,x)}}(this,Object);