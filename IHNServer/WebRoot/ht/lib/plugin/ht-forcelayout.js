!function(g,J){"use strict";var r="ht",o=r+".layout.",m=g[r]||module.parent.exports.ht,X=m.List,d=m.DataModel,$=m.Node,M=m.Edge,D=m.Group,Z=Math,q=Z.sqrt,V=Z.random,N=Z.max,E=Z.min,Y=function(S){return S*S};m.Default.getInternal().addMSMap({ms_force:function(l){l._interval=50,l._stepCount=10,l._motionLimit=.01,l._edgeRepulsion=.65,l._nodeRepulsion=.65,l._damper=1,l._maxMotion=0,l._motionRatio=0,l.init=function(_){var y=this;_ instanceof d?y.dm=_:y.gv=_,y._nodeMap={},y._nodes=new X,y._edges=new X},l.start=function(){var H=this,p=H.gv;if(!H._timer){var s=H.cdm=p?p.dm():H.dm;s.mm(H.handleDataModelChange,H),s.md(H.handleDataPropertyChange,H),p&&p.mp(H.handleGV,H),s.each(function(j){if(H.isVisible(j)&&H.isLayoutable(j)&&j instanceof $)if(H instanceof w){var R=j.p3();j.p3([R[0]+V(),R[1]+V(),R[2]+V()])}else R=j.p(),j.p(R.x+V(),R.y+V())}),H._timer=setInterval(function(){H.relax()},H._interval),H._damper=1}},l.stop=function(){var C=this;C._timer&&(C.cdm.umm(C.handleDataModelChange,C),C.cdm.umd(C.handleDataPropertyChange,C),C.gv&&C.gv.ump(C.handleGV,C),clearInterval(C._timer),delete C._timer,delete C.cdm)},l.handleGV=function(f){var H=this;if("dataModel"===f.property){var a=f.oldValue,q=f.newValue;a&&(a.umm(H.handleDataModelChange,H),a.umd(H.handleDataPropertyChange,H)),this.cdm=q,q.mm(H.handleDataModelChange,H),q.md(H.handleDataPropertyChange,H)}},l.relax=function(){var u=this;if(!(u._damper<.1&&u._maxMotion<u._motionLimit)){this.cdm.each(function(y){u.isVisible(y)&&(y instanceof M?u.addEdge(y):y instanceof $&&u.addNode(y))});for(var _,t,g=0,N=u._edges,v=u._nodes,S=v.size();g<u._stepCount;g++){for(N.each(u.relaxEdge,u),_=0;S>_;_++)for(t=0;S>t;t++)u.relaxNode(v.get(_),v.get(t));u.moveNode()}u._isAdjusting=1,v.each(function(K){K.fix||(K.p?K.v.p3(K.p):K.v.p(K.x,K.y))}),delete u._isAdjusting,u._nodeMap={},v.clear(),N.clear(),u.onRelaxed()}},l.onRelaxed=function(){},l.isRunning=function(){return!!this._timer},l.isVisible=function(l){return l.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(l):!0},l.isLayoutable=function(U){if(U.s("layoutable")===!1)return!1;if(U instanceof D)return!1;var E=this;return E.gv?E.gv.isMovable(U)&&!E.gv.isSelected(U):!(E.cdm||E.dm).sm().co(U)},l.getNodeRepulsion=function(){return this._nodeRepulsion},l.setNodeRepulsion=function(F){this._nodeRepulsion=F,this._damper=1},l.getEdgeRepulsion=function(){return this._edgeRepulsion},l.setEdgeRepulsion=function(P){this._edgeRepulsion=P,this._damper=1},l.getStepCount=function(){return this._stepCount},l.setStepCount=function(e){this._stepCount=e,this._damper=1},l.getInterval=function(){return this._interval},l.setInterval=function(C){var t=this;t._interval!==C&&(t._interval=C,t._timer&&(clearInterval(t._timer),t._timer=setInterval(function(){t.relax()},C)))},l.handleDataPropertyChange=function(f){!this._isAdjusting&&this.isVisible(f.data)&&(this._damper=1)},l.handleDataModelChange=function(){this._damper=1},l.damp=function(){var $=this._maxMotion,M=this._damper;this._motionRatio<=.001&&((.2>$||$>1&&.9>M)&&M>.01?this._damper-=.01:.4>$&&M>.003?this._damper-=.003:M>1e-4&&(this._damper-=1e-4)),$<this._motionLimit&&(this._damper=0)}}}),m.layout.ForceLayout=function(O){this.init(O)},m.Default.def(o+"ForceLayout",J,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(n){this._limitBounds=n,this._damper=1},getNodeSize:function(L){var g=this.gv;return g&&g.getDataUIBounds?g.getDataUIBounds(L):L.getRect()},addNode:function(R){var n=this,X=n._nodeMap[R._id];if(X)return X;var J=R.p();X={v:R,x:J.x,y:J.y,dx:0,dy:0,fix:!n.isLayoutable(R),s:n.getNodeSize(R)};var I=X.s,r=q(Y(I.width)+Y(I.height))*n._nodeRepulsion;return X.r=1>r?100:r,n._nodeMap[R._id]=X,n._nodes.add(X),X},addEdge:function(Q){if(Q._40I&&Q._41I){var o=this,h=o.addNode(Q._40I),b=o.addNode(Q._41I),B={s:h,t:b};b=b.s,h=h.s;var l=b.width+h.width,W=b.height+h.height;B.length=q(l*l+W*W)*o._edgeRepulsion,B.length<=0&&(B.length=100),o._edges.add(B)}},relaxEdge:function($){var m=$.t,N=$.s,j=m.x-N.x,L=m.y-N.y,t=q(j*j+L*L),E=100*$.length,U=.25*j/E*t,_=.25*L/E*t;m.dx=m.dx-U,m.dy=m.dy-_,N.dx=N.dx+U,N.dy=N.dy+_},relaxNode:function(B,e){if(B!==e){var j=0,J=0,q=B.x-e.x,D=B.y-e.y,b=q*q+D*D;0===b?(j=V(),J=V()):36e4>b&&(j=q/b,J=D/b);var $=B.r*e.r/400;j*=$,J*=$,B.dx+=j,B.dy+=J,e.dx-=j,e.dy-=J}},moveNode:function(){var g=this,e=g._limitBounds,H=g._maxMotion,h=0,b=g._damper;g._nodes.each(function(B){if(!B.fix){var k=B.dx*b,C=B.dy*b;if(B.dx=k/2,B.dy=C/2,h=N(q(k*k+C*C),h),B.x+=N(-40,E(40,k)),B.y+=N(-40,E(40,C)),e){B.x<e.x&&(B.x=e.x,g.adjust(1,0)),B.y<e.y&&(B.y=e.y,g.adjust(0,1));var m=B.s;B.x+m.width>e.x+e.width&&(B.x=e.x+e.width-m.width,g.adjust(-1,0)),B.y+m.height>e.y+e.height&&(B.y=e.y+e.height-m.height,g.adjust(0,-1))}}}),g._maxMotion=h,g._motionRatio=h>0?H/h-1:0,g.damp()},adjust:function(E,W){var R=this._limitBounds;this._nodes.each(function(p){E>0?(!R||p.x+p.s.width+E<R.x+R.width)&&(p.x+=E):(!R||p.x+E>R.x)&&(p.x+=E),W>0?(!R||p.y+p.s.height+W<R.y+R.height)&&(p.y+=W):(!R||p.y+W>R.y)&&(p.y+=W)})}});var w=m.layout.Force3dLayout=function(W){this.init(W)};m.Default.def(o+"Force3dLayout",J,{ms_force:1,getNodeSize3d:function(R){return R.s3()},addNode:function(r){var a=this,z=a._nodeMap[r._id];if(z)return z;z={v:r,p:r.p3(),d:[0,0,0],fix:!a.isLayoutable(r),s:a.getNodeSize3d(r)};var f=z.s,_=m.Default.getDistance(f)*a._nodeRepulsion;return z.r=1>_?100:_,a._nodeMap[r._id]=z,a._nodes.add(z),z},addEdge:function(u){if(u._40I&&u._41I){var i=this,b=i.addNode(u._40I),$=i.addNode(u._41I),K={s:b,t:$};$=$.s,b=b.s,K.length=q(Y($[0]+b[0])+Y($[1]+b[1])+Y($[2]+b[2]))*i._edgeRepulsion,K.length<=0&&(K.length=100),i._edges.add(K)}},relaxEdge:function(d){var N=d.t.p,b=d.s.p,o=d.t.d,k=d.s.d,z=N[0]-b[0],c=N[1]-b[1],w=N[2]-b[2],U=q(z*z+c*c+w*w),Y=100*d.length,B=.25*z/Y*U,Q=.25*c/Y*U,l=.25*w/Y*U;o[0]-=B,o[1]-=Q,o[2]-=l,k[0]+=B,k[1]+=Q,k[2]+=l},relaxNode:function(F,C){if(F!==C){var e=F.p,h=C.p,z=0,$=0,U=0,p=e[0]-h[0],d=e[1]-h[1],Z=e[2]-h[2],x=p*p+d*d+Z*Z;0===x?(z=V(),$=V(),U=V()):216e6>x&&(z=p/x,$=d/x,U=Z/x);var H=F.r*C.r/400,t=F.d,B=C.d;z*=H,$*=H,U*=H,t[0]+=z,t[1]+=$,t[2]+=U,B[0]-=z,B[1]-=$,B[2]-=U}},moveNode:function(){var Q=this,y=Q._maxMotion,L=0,k=Q._damper;Q._nodes.each(function(v){if(!v.fix){var t=v.p,U=v.d,C=U[0]*k,R=U[1]*k,P=U[2]*k;U[0]=C/2,U[1]=R/2,U[2]=P/2,L=N(q(C*C+R*R+P*P),L),t[0]+=N(-40,E(40,C)),t[1]+=N(-40,E(40,R)),t[2]+=N(-40,E(40,P))}}),Q._maxMotion=L,Q._motionRatio=L>0?y/L-1:0,Q.damp()}})}(this,Object);